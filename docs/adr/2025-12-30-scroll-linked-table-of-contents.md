# Implement Scroll-Linked Table of Contents

## Status

accepted

## Context

ブログ記事が長くなると、読者が現在の位置を把握したり、目的のセクションにジャンプしたりすることが困難になる。特に技術記事では構造化された目次が読みやすさを大きく向上させる。

課題:
- 記事の見出し構造を自動的に抽出して目次を生成したい
- 現在のスクロール位置に応じて目次のアクティブ項目をハイライトしたい
- ページのパフォーマンスに影響を与えない実装が必要

<!-- TODO: 以下の情報を確認・追記してください -->
<!-- - 目次機能追加を検討したきっかけ -->
<!-- - 既存の他のブログサイトでの調査結果 -->
<!-- - ユーザーからのフィードバック -->

## Decision

**スクロール連動型の目次機能** を実装する。

### 実装アプローチ

<!-- TODO: 以下の具体的な実装方法を確認・詳細化してください -->

1. **見出し抽出**:
   - MDX処理パイプラインのrehypeプラグイン (`rehypeExtractHeadings`) で見出し情報を抽出
   - h2, h3レベルの見出しを対象とする（推測）

2. **目次コンポーネント** (`src/components/TableOfContents.tsx`):
   - クライアントコンポーネントとして実装
   - Intersection Observer APIを使用してスクロール位置を検出
   - 現在表示中のセクションに対応する目次項目をハイライト

3. **デザイン**:
   - 記事本文の右側または上部に配置
   - スクロール時にスティッキー表示（推測）
   - モバイル対応

### Considered Options

<!-- TODO: 以下の選択肢を確認・追記してください -->

1. **スクロール連動型** (採用)
   - Intersection Observer APIを使用
   - アクティブセクションのハイライト

2. **シンプルな静的目次**
   - アンカーリンクのみ
   - スクロール連動なし

3. **サードパーティライブラリ使用**
   <!-- 検討したライブラリがあれば記載 -->

### 選択理由

<!-- TODO: 選択理由を詳細化してください -->
- ユーザー体験の向上
- 既存のrehypeプラグインとの統合が容易
- Intersection Observer APIによるパフォーマンス効率

## Consequences

### より容易になること

- **記事のナビゲーション**: 長い記事でも現在位置を把握しやすい
- **セクションへのジャンプ**: 目次からワンクリックで目的のセクションへ移動
- **読みやすさの向上**: 記事の構造が視覚的に理解しやすい
- **自動生成**: 見出しを書くだけで目次が自動生成される

### より困難になること

<!-- TODO: 以下の項目を確認・追記してください -->
- クライアントサイドJavaScriptへの依存
- Intersection Observer APIのブラウザ互換性確認が必要
  - ただし、モダンブラウザでは広くサポートされている
- モバイルでの表示方法の最適化
<!-- - その他、実装時に発生した課題があれば記載 -->

### 技術的詳細

- **コンポーネント**: `src/components/TableOfContents.tsx`
- **見出し抽出**: rehypeプラグイン経由（既存の `rehypeExtractHeadings` を活用、推測）
- **スクロール検出**: Intersection Observer API
- **スタイル**: Tailwind CSS

<!-- TODO: 以下の情報を追記してください -->
<!-- - 余白調整の意思決定 (feat: 記事と目次の間の余白を拡大（32px → 48px）) -->
<!-- - パフォーマンス計測結果 -->
<!-- - ユーザーフィードバック -->
